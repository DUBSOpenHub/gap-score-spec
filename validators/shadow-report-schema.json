{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Shadow Score Report",
  "description": "Schema for Shadow Score reports conforming to Shadow Score Spec v1.0.0",
  "type": "object",
  "required": ["shadow_score_spec_version", "report", "sealed_tests", "failures"],
  "properties": {
    "shadow_score_spec_version": {
      "type": "string",
      "description": "Version of the Shadow Score Spec this report conforms to",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "report": {
      "type": "object",
      "required": ["shadow_score", "level"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for this run/report"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of report generation"
        },
        "specification": {
          "type": "string",
          "description": "Path or identifier of the specification document"
        },
        "shadow_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Computed Shadow Score as a percentage"
        },
        "level": {
          "type": "string",
          "enum": ["perfect", "minor", "moderate", "significant", "critical"],
          "description": "Shadow Score classification level"
        },
        "sealed_hash": {
          "type": "string",
          "description": "SHA-256 hash of sealed test directory for tamper evidence"
        }
      }
    },
    "sealed_tests": {
      "type": "object",
      "required": ["total", "passed", "failed"],
      "properties": {
        "total": { "type": "integer", "minimum": 0 },
        "passed": { "type": "integer", "minimum": 0 },
        "failed": { "type": "integer", "minimum": 0 }
      }
    },
    "open_tests": {
      "type": "object",
      "properties": {
        "total": { "type": "integer", "minimum": 0 },
        "passed": { "type": "integer", "minimum": 0 },
        "failed": { "type": "integer", "minimum": 0 }
      }
    },
    "failures": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["test_name", "message"],
        "properties": {
          "test_name": {
            "type": "string",
            "description": "Name of the failing sealed test"
          },
          "category": {
            "type": "string",
            "enum": ["happy_path", "edge_case", "error_handling", "security", "unknown"],
            "description": "Test category classification"
          },
          "expected": {
            "type": "string",
            "description": "Expected result"
          },
          "actual": {
            "type": "string",
            "description": "Actual result"
          },
          "message": {
            "type": "string",
            "description": "Human-readable failure description (shared during hardening)"
          }
        }
      }
    },
    "coverage_comparison": {
      "type": "object",
      "description": "Category-level comparison between sealed and open tests",
      "properties": {
        "happy_path": { "$ref": "#/definitions/category_comparison" },
        "edge_case": { "$ref": "#/definitions/category_comparison" },
        "error_handling": { "$ref": "#/definitions/category_comparison" },
        "security": { "$ref": "#/definitions/category_comparison" }
      }
    },
    "hardening": {
      "type": "object",
      "properties": {
        "cycles_completed": { "type": "integer", "minimum": 0 },
        "max_cycles": { "type": "integer", "minimum": 1 },
        "initial_shadow_score": { "type": "number", "minimum": 0, "maximum": 100 },
        "final_shadow_score": { "type": "number", "minimum": 0, "maximum": 100 }
      }
    }
  },
  "definitions": {
    "category_comparison": {
      "type": "object",
      "properties": {
        "open": { "type": "integer", "minimum": 0 },
        "sealed": { "type": "integer", "minimum": 0 },
        "delta": { "type": "integer" }
      }
    }
  }
}
